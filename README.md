# Безопасность интернет-магазина
[пример архитектуры](photo.jpg)
## Архитектура
### Клиенты веб-приложения
Пользователи используют браузеры и мобильные устройства для доступа к сайту, внешние информационные системы взаимодействуют с приложением через API для интеграции с другими платформами.
### Система безопасности и балансировка нагрузки (СЗИ)
Защита от DDoS - первая линия защиты от распределенных атак, направленных на перегрузку сервера.
NGFW (Next-Generation Firewall) - межсетевой экран нового поколения, обеспечивающий контроль трафика и предотвращение сложных атак.
WAF (Web Application Firewall) защищает веб-приложение от атак на уровне приложений, таких как SQL-инъекции или XSS. Балансировщик нагрузки  распределяет входящие запросы между веб-серверами для повышения производительности и надежности.
### Отображение (Frontend)
CDN (Content Delivery Network) используется для ускорения загрузки контента, распределяя его по географически распределенным серверам, веб-серверы принимают запросы от клиентов и передают их на серверы приложений для обработки.
Системы защиты и мониторинга - инструменты, отслеживающие производительность, ошибки и возможные угрозы безопасности в реальном времени.
Логика (Backend)
Серверы приложений обрабатывают запросы на уровне клиентского интерфейса, выполняют бизнес-логику и взаимодействуют с базами данных и кэшированием. API серверы  предоставляют интерфейсы для внешних систем и приложений, взаимодействующих через API.
### Данные
Серверы кэширования используются для временного хранения часто запрашиваемых данных для ускорения работы сайта, серверы баз данных хранят основную информацию о продуктах, пользователях, заказах и других бизнес-процессах.
HSM (Hardware Security Module) - аппаратный модуль для безопасного управления ключами шифрования и другой криптографической информацией.
### Группировка и взаимодействие
Каждый блок логики и данных разделен по бизнес-процессам, что повышает безопасность и устойчивость системы к сбоям. Для наиболее важных операций предусмотрен дополнительный уровень защиты и резервирования.
## Алгоритм работы клиента интернет-магазина техники:
### Подключение к сайту:
Клиент открывает браузер или мобильное приложение и вводит адрес сайта интернет-магазина, запрос в обязательном порядке отправляется через DDoS-защиту.
### Балансировка нагрузки и доступ к веб-серверу:
Запрос проходит через NGFW (Next-Generation Firewall.
Балансировщик нагрузки распределяет запрос между веб-серверами для обработки.
### Отображение сайта:
Веб-сервер обрабатывает запросы и взаимодействует с фронтенд-серверами приложений, которые отвечают за отображение информации на стороне клиента (каталог товаров, описание продуктов). 
### Оформление заказа:
Клиент выбирает товар и оформляет заказ.
Запрос отправляется на backend-серверы приложений, которые обрабатывают бизнес-логику (расчет стоимости, наличие товара, учет скидок и пр.).
### Оплата:
При переходе к оплате, сервер приложения обращается к API серверу для интеграции с платёжной системой или сторонними сервисами.
Для безопасности транзакций используются HSM (аппаратные модули безопасности), которые шифруют данные и защищают платёжные операции.
### Подтверждение заказа:
Сервер кэширования ускоряет процесс подтверждения заказа, сохраняя временные данные.
Backend-сервер взаимодействует с базами данных, проверяя наличие товара, после чего подтверждает заказ и отправляет информацию клиенту.
## Алгоритм работы администратора интернет-магазина техники:
### Аутентификация и доступ к системе:
Администратор подключается к системе через защищенный интерфейс, используя двухфакторную аутентификацию, веб-сервер проверяет его учетные данные через систему безопасности.
### Мониторинг системы:
Администратор получает доступ к панели мониторинга, где отображаются ключевые метрики: состояние веб-серверов, нагрузка на балансировщик, трафик через CDN.
### Управление контентом:
Администратор может добавлять, изменять или удалять информацию о товарах через серверы приложений (frontend/backend), а при изменении информации система кэширования обновляется для ускорения работы сайта.
### Обновление и техническое обслуживание:
Администратор применяет обновления к серверным системам. Все действия в обязательном порядке проходят через системы безопасности для предотвращения внедрения вредоносного кода.
### Управление базами данных:
Администратор проверяет целостность данных на серверах баз данных и проводит резервное копирование.
### Реагирование на инциденты:
При обнаружении инцидентов безопасности администратор должен получать уведомления от системы мониторинга. Далее он анализирует логи, идентифицирует источник угрозы и принимает надлежащие меры по их устранению.
## Три ключевые цели безопасности для интернет-магазина:
### Обеспечение доступности
Цель состоит в обеспечении гарантии того, что сайт интернет-магазина будет доступен для пользователей в любой момент времени, даже в условиях внешних угроз. 
### Конфиденциальность данных клиентов
Цель состоит в защите личных и платежных данных пользователей от несанкционированного доступа и утечек.
### Целостность данных и систем
Цель: гарантировать, что данные и системы интернет-магазина остаются неизменными и защищены от манипуляций, как со стороны злоумышленников, так и в результате внутренних ошибок.
## Угрозы
| **Тип Уязвимости**                                     | **Риск**  | **Количество** | **% от общего** |
|--------------------------------------------------------|-----------|----------------|-----------------|
| Раскрытие PII                                           | Высокий   | 1              | (2,7 %)         |
| CSP: Директива подстановочного знака                   | Средний   | 1              | (2,7 %)         |
| Заголовок Content Security Policy (CSP) не задан       | Средний   | 1205           | (3 256,8 %)     |
| Идентификатор (ID) сеанса при перезаписи URL           | Средний   | 18             | (48,6 %)        |
| Междоменная неправильная конфигурация                  | Средний   | 29             | (78,4 %)        |
| Отсутствует заголовок (Header) для защиты от кликджекинга | Средний   | 280            | (756,8 %)       |
| Отсутствуют токены против CSRF атак                    | Средний   | 68             | (183,8 %)       |
| Раскрытие ошибок приложения                            | Средний   | 1              | (2,7 %)         |
| Уязвимость JS Библиотеки (Library)                     | Средний   | 1              | (2,7 %)         |
| CSP: Уведомления                                        | Низкий    | 1              | (2,7 %)         |
| Cookie No HttpOnly Flag                                | Низкий    | 1090           | (2 945,9 %)     |
| Cookie без атрибута SameSite                           | Низкий    | 1076           | (2 908,1 %)     |
| Cookie без флажка безопасности                         | Низкий    | 887            | (2 397,3 %)     |
| Cookie с атрибутом SameSite нет                        | Низкий    | 34             | (91,9 %)        |
| Включение исходного файла междоменного JavaScript      | Низкий    | 7217           | (19 505,4 %)    |
| Заголовок Strict-Transport-Security не установлен      | Низкий    | 1322           | (3 573,0 %)     |
| Заголовок X-Content-Type-Options отсутствует           | Низкий    | 345            | (932,4 %)       |
| Защищенные страницы содержат смешанный контент         | Низкий    | 1              | (2,7 %)         |
| Множественные записи заголовков Strict-Transport-Security (несовместимы со спецификацией) | Низкий | 1 | (2,7 %) |
| Обнаружена Большая Переадресация (Потенциальная Утечка Конфиденциальной Информации) | Низкий | 16 | (43,2 %) |
| Раскрытие информации - сообщения об ошибках отладки    | Низкий    | 1              | (2,7 %)         |
| Раскрытие отметки времени - Unix                       | Низкий    | 287            | (775,7 %)       |
| Раскрытие ошибок приложения                            | Низкий    | 2              | (5,4 %)         |
| Раскрытие частной ИС                                   | Низкий    | 129            | (348,6 %)       |
| Сервер утекает информацию через поля заголовка HTTP-ответа "X-Powered-By" | Низкий | 153 | (413,5 %) |
| Сервер утечка информации о версии через поле заголовка HTTP-ответа «Server» | Низкий | 25 | (67,6 %) |
| Authentication Request Identified                      | Информационный | 17         | (45,9 %)        |
| Cookie с произвольным ограничением                     | Информационный | 457        | (1 235,1 %)     |
| Session Management Response Identified                 | Информационный | 459        | (1 240,5 %)     |
| Атрибут элемента HTML, управляемый пользователем (потенциальный XSS) | Информационный | 290 | (783,8 %) |
| Заголовок Content-Type отсутствует                     | Информационный | 13         | (35,1 %)        |
| Отравление Cookie                                      | Информационный | 1          | (2,7 %)         |
| Пересмотрите директивы управления кэшем                | Информационный | 132        | (356,8 %)       |
| Получено из кеша                                       | Информационный | 33         | (89,2 %)        |
| Раскрытие информации - конфиденциальная информация в URL | Информационный | 40         | (108,1 %)       |
| Раскрытие информации - подозрительные комментарии      | Информационный | 224        | (605,4 %)       |
| Современное веб-приложение                             | Информационный | 503        | (1 359,5 %)     |
### 1 Защита личных данных (PII)
Удаление метода GET, привязали его к методу POST и добавили заголовок токена авторизации в вышеупомянутый запрос метода POST, где каждый раз он будет аутентифицироваться с сервера.
Это позволило избавиться от возможности повторить описанный выше сценарий — атака с копированием персональных данных пользователя через API.
## Список используемых литератур
- https://habr.com/ru/companies/simplepay/articles/258499/
- https://owasp.org/Top10/
- https://cwe.mitre.org/
- https://www.zaproxy.org/getting-started/
